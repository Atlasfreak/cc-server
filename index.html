<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>r/placede Bot Status</title>
</head>

<body class="bg-dark text-white">
    <div class="container mt-3">
        <div class="d-flex justify-content-center">
            <h1>r/placede Bot Status</h1>
        </div>
        <hr>
        <div class="d-flex justify-content-center">
            <div class="bg-secondary rounded p-4" style="width: fit-content;">
                <div class="d-flex justify-content-center">
                    <h2>Aktuell verbundene Bots:</h2>
                </div>
                <div class="d-flex justify-content-center">
                    <h2 id="bot-count"><b>...</b></h2>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center my-4">
            <div class="bg-secondary rounded p-4" style="width: fit-content;">
                <div class="d-flex justify-content-center">
                    <h2>Aktuelle Websocket-Verbindungen:</h2>
                </div>
                <div class="d-flex justify-content-center">
                    <h2 id="websocket-connections"><b>...</b></h2>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center my-4">
            <div class="bg-primary rounded p-4" style="width: fit-content;">
                <div class="d-flex justify-content-center">
                    <h2>Fehlerhafte Pixel:</h2>
                </div>
                <div class="d-flex justify-content-center">
                    <h2 id="mismatched-pixels"><b>...</b></h2>
                </div>
                <div class="d-flex justify-content-center">
                    <h2 id="mismatched-percentage"><b>...</b></h2>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center my-4">
            <div class="bg-info rounded p-4" style="width: fit-content;">
                <div class="d-flex justify-content-center">
                    <h2>Aktuelles Reddit Canvas:</h2>
                </div>
                <div class="d-flex justify-content-center">
                    <img class="w-100" id="reddit-canvas" src="data:image/png;base64," alt="Reddit r/place Canvas">
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center my-4">
            <div class="bg-danger rounded p-4" style="width: fit-content;">
                <div class="d-flex justify-content-center">
                    <h2>Aktuell falsche Pixel:</h2>
                </div>
                <div class="d-flex justify-content-center">
                    <img class="w-100" id="wrong-canvas" src="data:image/png;base64," alt="Reddit r/place Canvas">
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center my-4">
            <div class="bg-success rounded p-4" style="width: fit-content;">
                <div class="d-flex justify-content-center">
                    <h2>Aktuell von uns gesch√ºtzte Pixel:</h2>
                </div>
                <div class="d-flex justify-content-center">
                    <img class="w-100" id="botted-canvas" src="data:image/png;base64," alt="Reddit r/place Canvas">
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script>
        async function get_connection_count() {
            const response = await fetch("https://dev.placede.flky.dev/users/count");
            const data = await response.json();
            let bot_count = data.connections;
            let websocket_connections = data.advertised_accounts;

            return [bot_count, websocket_connections];
        }

        async function get_pixel_amount() {
            const response = await fetch("https://dev.placede.flky.dev/pixel/amount");
            const data = await response.json();
            let mismatched = data.mismatched;
            let total = data.all;
            return [mismatched, total];
        }

        async function get_images() {
            const response = await fetch("https://dev.placede.flky.dev/pixel/get_images");
            const data = await response.json();
            let reddit = data.reddit;
            let wrong = data.wrong;
            let config = data.config;
            return [reddit, wrong, config];
        }

        $(async function () {
            let connections = await get_connection_count();
            $("#bot-count > b").html(connections[0]);
            $("#websocket-connections > b").html(connections[1]);

            let pixel_amount = await get_pixel_amount();
            $("#mismatched-pixels").html(pixel_amount[0]);
            $("#mismatched-percentage").html(`${Number.parseFloat((pixel_amount[0] / pixel_amount[1]) * 100).toFixed(2)}%`);

            let images = await get_images();
            $("#reddit-canvas").attr("src", "data:image/png;base64," + images[0]);
            $("#wrong-canvas").attr("src", "data:image/png;base64," + images[1]);
            $("#botted-canvas").attr("src", "data:image/png;base64," + images[2]);
        });
    </script>
</body>

</html>